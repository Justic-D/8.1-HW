# Домашнее задание к занятию "`Название занятия`" - `Фамилия и имя студента`

## Задание 1 Резервное копирование

## Кейс

Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.
Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.
1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.
1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

***Приведите ответ в свободной форме.***

## Ответ:

- 1.1  Тут подойдёт больше всего дифференциальное резервное копирование. Т.к. экономи много места для хранени и намного быстрей чем полное копирование. Очень полезный инструмент при добавлении данныхх - часто

- 1.2. Тут подойдёт инкрементный бэкап каждый час. Разумный расход места на диске, и кушает ресурсов не так много.

- 1.3.* Использовать систему репликаций Master-Slave, использовать NAS или Облако.

---

## Задание 2 PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

**Приведите ответ в свободной форме.**

## Ответ:

### 2.1  Из официальной документации:

- Выгрузка БД в SQL файл:

```
$ pg_dump mydb > db.sql

Пример:

$ pg_dump accses.db > /tmp/acscses.db.sql
```

- Выгрузка БД в специальном формате:

```
$ pg_dump -Fc mydb > db.dump

Пример:

$ pg_dump -Fc acscses.db > /tmp/acscses.db.dump
```

- Восстановление PG спец формат:

```
$ pg_dump -Fc mydb > db.dump

Пример:

$ pg_dump -Fc acscses.db > /tmp/acscses.db.dump
```

- Можно удалить базу данных и восстановить её из копии:

```
$ dropdb mydb
$ pg_restore -C -d postgres db.dump

Пример:

$ dropdb acscses.db
$ pg_restore -C -d postgres acscses.db.dump
```

### 2.1.* Да можно:

- Скрипт бекапа (c разной документации) с удалением:

```
#!/bin/sh

PATH=/etc:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin

PGPASSWORD=some_password
export PGPASSWORD
pathB=/mnt/backup
dbUser=dbadmin
database=acscses

find $pathB \( -name "*-1[^5].*" -o -name "*-[023]?.*" \) -ctime +61 -delete
pg_dump -U $dbUser $database | gzip > $pathB/pgsql_$(date "+%Y-%m-%d").sql.gz

unset PGPASSWORD
```

- Чтобы настроить регулярное выполнение, выполним следующую команду в планировщике crontab:

```
# crontab -e
3 0 * * * /etc/scripts/pgsql_dump.sh # postgres pg dump
```

- Чтобы выполнить аналогичную команду на удаленном сервере, достаточно добавить ключ -h:

```
# pg_dump -h 192.168.56.101 acscses > /tmp/acscses.dump
```

- При помощи специальных ключей можно создавать резервные копии структуры данных или непосредственно данных:

```
# pg_dump --schema-only acscses > /tmp/acscses.dump
# pg_dump --data-only acscses > /tmp/acscses.dump
```

---

## Задание 3 MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

***Приведите ответ в свободной форме.***

## Ответ:

### 3.1 Офиц документация:

- Энтерпрайз решение:

```
mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
  --incremental --incremental-base=history:last_backup \
  --backup-dir=/home/dbadmin/temp_dir \
  --backup-image=incremental_image1.bi \
   backup-to-image
```

```
mysqlbackup --defaults-file=/home/dbadmin/my.cnf --incremental \
--incremental-base=dir:/incr-backup/wednesday \
--incremental-backup-dir=/incr-backup/thursday \
backup
```

- С помощью утилиты XtraBackup:

```
xtrabackup --backup --target-dir=/data/backups/inc1 --incremental-basedir=/data/backups/base
```

### 3.1* Да практически во всех случаях:

- Повышение производительности чтения данных. 
С помощью репликации мы сможем поддерживать несколько копий сервера, и распределять между ними нагрузку.
   
- Повышение отказоустойчивости. 
Репликация позволяет избавиться от единственной точки отказа, которой является одиночный сервер БД. 
В случае аварии на основном сервере, есть возможность быстро переключить нагрузку на резервный. распространение данных.

- Распределение нагрузки. 
В случае, если БД обслуживает запросы разных типов (быстрые и легкие, медленные и тяжелые), 
может иметь смысл развести эти запросы по разным серверам, для увеличения эффективности работы каждого типа. 
Тестирование новых конфигураций. 
С помощью репликации есть возможность проведения тестирования новых версий сервера БД, изменения параметров конфигурации, 
изменения типов хранилища данных.

- Резервное копирование. 
С помощью репликации есть возможность делать механизмы резервного копирования более гибкими и вносить меньше негативных эффектов в работающую систему.
